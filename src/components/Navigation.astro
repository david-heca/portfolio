---
const navItems = [
  { href: '#about', label: 'Sobre mí' },
  { href: '#skills', label: 'Habilidades' },
  { href: '#projects', label: 'Proyectos' },
  { href: '#experience', label: 'Experiencia' },
  { href: '#education', label: 'Educación' },
  { href: '#contact', label: 'Contacto' }
];
---

<nav 
  id="navigation" 
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 transform -translate-y-full opacity-0"
>
  <div class="backdrop-blur-xl bg-slate-900/70 border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <!-- Logo/Brand -->
        <a 
          href="#hero" 
          class="text-lg font-semibold text-white hover:text-purple-300 transition-colors"
        >
          David Herrera
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-8">
          {navItems.map((item) => (
            <a 
              href={item.href}
              class="nav-link text-sm text-gray-300 hover:text-white transition-colors relative py-2"
            >
              {item.label}
            </a>
          ))}
        </div>

        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-btn"
          class="md:hidden w-8 h-8 flex flex-col justify-center items-center space-y-1 group"
          aria-label="Menú"
        >
          <span class="block w-5 h-0.5 bg-gray-300 group-hover:bg-white transition-colors"></span>
          <span class="block w-5 h-0.5 bg-gray-300 group-hover:bg-white transition-colors"></span>
          <span class="block w-5 h-0.5 bg-gray-300 group-hover:bg-white transition-colors"></span>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div 
        id="mobile-menu" 
        class="md:hidden overflow-hidden transition-all duration-300 max-h-0"
      >
        <div class="py-4 space-y-2 border-t border-white/10">
          {navItems.map((item) => (
            <a 
              href={item.href}
              class="mobile-nav-link block px-4 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors"
            >
              {item.label}
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navigation = document.getElementById('navigation');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');

    // Verificar que todos los elementos existen
    if (!navigation || !mobileMenuBtn || !mobileMenu) {
      console.error('Navigation: Required elements not found');
      return;
    }

    // Control de visibilidad del header
    let lastScrollY = window.scrollY;
    let isVisible = false;

    const toggleNavigation = () => {
      const heroSection = document.getElementById('hero');
      const heroHeight = heroSection ? heroSection.offsetHeight : 800;
      const currentScrollY = window.scrollY;

      if (currentScrollY > heroHeight && !isVisible) {
        navigation.classList.remove('-translate-y-full', 'opacity-0');
        navigation.classList.add('translate-y-0', 'opacity-100');
        isVisible = true;
      } else if (currentScrollY <= heroHeight && isVisible) {
        navigation.classList.add('-translate-y-full', 'opacity-0');
        navigation.classList.remove('translate-y-0', 'opacity-100');
        isVisible = false;
        // Cerrar menú móvil si está abierto
        if (mobileMenu && mobileMenu.style.maxHeight !== '0px') {
          toggleMobileMenu();
        }
      }
    };

    // Scroll con throttle
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          toggleNavigation();
          updateActiveSection();
          ticking = false;
        });
        ticking = true;
      }
    };

    // Toggle menú móvil
    const toggleMobileMenu = () => {
      if (!mobileMenu) return;
      
      if (mobileMenu.style.maxHeight === '0px' || !mobileMenu.style.maxHeight) {
        mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
      } else {
        mobileMenu.style.maxHeight = '0px';
      }
    };

    // Actualizar sección activa
    const updateActiveSection = () => {
      const sections = ['about', 'skills', 'projects', 'experience', 'education', 'contact'];
      
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const rect = section.getBoundingClientRect();
          const isInView = rect.top <= 100 && rect.bottom > 100;
          
          navLinks.forEach(link => {
            if (link.getAttribute('href') === `#${sectionId}`) {
              if (isInView) {
                link.classList.add('active');
              } else {
                link.classList.remove('active');
              }
            }
          });
        }
      });
    };

    // Event listeners
    window.addEventListener('scroll', handleScroll);
    mobileMenuBtn.addEventListener('click', toggleMobileMenu);

    // Cerrar menú móvil al hacer clic en un enlace
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth < 768) {
          toggleMobileMenu();
        }
      });
    });

    // Verificar posición inicial
    toggleNavigation();
    updateActiveSection();
  });
</script>