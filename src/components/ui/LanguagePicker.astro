---
import { PiGlobeDuotone } from "react-icons/pi";
import { getLangFromUrl, useTranslations } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;
const targetLang = lang === "es" ? "en" : "es";
const label = targetLang.toUpperCase();

function getPathForLang(l: string) {
  // Remove current lang prefix if present
  let path = currentPath;
  const parts = path.split("/");
  if (parts[1] === "en" || parts[1] === "es") {
    parts.splice(1, 1);
    path = parts.join("/") || "/";
  }

  if (l === "es") return path; // es is default, so root
  return `/${l}${path === "/" ? "" : path}`;
}

const targetHref = getPathForLang(targetLang);
---

<a
  href={targetHref}
  class="flex gap-1 px-3 py-1.5 font-mono text-xs uppercase tracking-wider transition-colors rounded-md items-center"
  style="color: var(--color-text-tertiary);"
>
  <PiGlobeDuotone className="w-5 h-5" />
  <span class="font-mono text-xs font-medium" id="current-lang-label">
    {label}
  </span>
</a>
