---
import { PiGlobeDuotone } from "react-icons/pi";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;
const targetLang = lang === "es" ? "en" : "es";
const label = targetLang.toUpperCase();

function getPathForLang(l: string) {
  // Remove current lang prefix if present
  let path = currentPath;
  const parts = path.split("/");
  if (parts[1] === "en" || parts[1] === "es") {
    parts.splice(1, 1);
    path = parts.join("/") || "/";
  }

  if (l === "es") return path; // es is default, so root
  return `/${l}${path === "/" ? "" : path}`;
}

const targetHref = getPathForLang(targetLang);
---

<a
  href={targetHref}
  class="flex gap-1 px-3 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
>
  <PiGlobeDuotone className="w-5 h-5 hidden md:block" />
  <span class="text-sm font-medium uppercase" id="current-lang-label">
    {label}
  </span>
</a>
